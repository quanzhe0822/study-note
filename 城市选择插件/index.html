<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.2.0-rc.2/echarts.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
    <style>
        body,
        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #res {
            position: fixed;
            top: 35%;
            left: 70%;
        }
    </style>
</head>

<body>
    <div id="main" style="width:90%;height:90%"></div>
    <div id="res">该地区包含的城市：</div>

    <script>
        var myChart = echarts.init(document.getElementById('main'));
        var barData=[{name:"东北",id:"7"},{name:"华北",id:"4"},{name:"华南",id:"2"},{name:"华东",id:"1"},{name:"华中",id:"3"},{name:"西南",id:"6"},{name:"西北",id:"5"},{name:"台港澳",id:"8"}];
        var data=[{name:"黑龙江",area:"东北"},{name:"吉林",area:"东北"},{name:"辽宁",area:"东北"},{name:"北京",area:"华北"},{name:"河北",area:"华北"},{name:"内蒙古",area:"华北"},{name:"天津",area:"华北"},{name:"山西",area:"华北"},{name:"上海",area:"华东"},{name:"江苏",area:"华东"},{name:"浙江",area:"华东"},{name:"安徽",area:"华东"},{name:"福建",area:"华东"},{name:"江西",area:"华东"},{name:"山东",area:"华东"},{name:"台湾",area:"台港澳"},{name:"广东",area:"华南"},{name:"广西",area:"华南"},{name:"海南",area:"华南"},{name:"澳门",area:"台港澳"},{name:"香港",area:"台港澳"},{name:"河南",area:"华中"},{name:"湖北",area:"华中"},{name:"湖南",area:"华中"},{name:"重庆",area:"西南"},{name:"四川",area:"西南"},{name:"贵州",area:"西南"},{name:"云南",area:"西南"},{name:"西藏",area:"西南"},{name:"陕西",area:"西北"},{name:"甘肃",area:"西北"},{name:"青海",area:"西北"},{name:"宁夏",area:"西北"},{name:"新疆",area:"西北"}];
        var geoData = [];
        var regionsData = []
        for (var v of data) {
            var id;
            var res = barData.filter(d => {
                return v.area === d.name
            })
            if (res) {
                id = res[0].id
            }
            geoData.push({
                name: v.name,
                area: v.area,
                id: id
            });
            regionsData.push({
                name: v.name,
            })
        }
        var option = {
            tooltip: {
                show: false,
                formatter: function (params) {
                    var lab = '';
                    var areaName = params.data.area;
                    var cities = geoData.filter(d => {
                        return d.area === areaName
                    })
                    cities.forEach(d => {
                        lab += d.name + '<br>'
                    })
                    return params.data.area + "地区:<br>" + lab;
                },
            },
            geo: {
                roam: true,
                map: 'china',
                label: {
                    emphasis: {
                        show: false
                    }
                },
                layoutCenter: ['45%', '50%'],
                layoutSize: 780,
                regions: regionsData
            },
            series: [{
                    name: 'mapSer',
                    type: 'map',
                    geoIndex: 0,

                    data: geoData
                }
            ]
        };
        myChart.setOption(option);
        myChart.on('click', function (param) {
            var id = param.data.id;
            $.ajax({
                url:'http://localhost:9011/searchTag/getListByRegion',
                type:'POST',
                contentType:'application/x-www-form-urlencoded',
                data:'regionId='+id,
                dataType: 'json',
                success:function(data){
                    console.log(data)
                },
                error: function (xhr, status, handler) {
                    console.log(xhr, status, handler)
                }


            })
        });


        var area;
        myChart.on('mousemove', function (param) {
            if (area === param.data.area) {
                return;
            } else {
                area = param.data.area;
                var d = []
                data.forEach(function (c) {
                    if (c.area === area) {
                        d.push({
                            name: c.name,
                            itemStyle: {
                                areaColor: 'red'
                            },
                        })
                    } else {
                        d.push(c)
                    }
                })
                option = {
                    geo: {
                        roam: true,
                        map: 'china',
                        layoutCenter: ['45%', '50%'],
                        layoutSize: 780,
                        emphasis: {
                            itemStyle: {
                                areaColor: 'red'
                            }
                        },
                        regions: d
                    },
                };
            }
            myChart.setOption(option);
        });
    </script>
</body>

</html>